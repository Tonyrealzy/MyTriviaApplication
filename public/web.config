<?xml version="1.0"?>
<configuration>
    <system.webServer>
        <httpErrors errorMode="Custom" existingResponse="Replace">
            <remove statusCode="404" subStatusCode="-1"/>
            <error statusCode="404" path="/" responseMode="ExecuteURL"/>
        </httpErrors>
 
        <httpProtocol>
            <customHeaders>
                <add name="Strict-Transport-Security" value="max-age=31536000; includeSubDomains; preload"/>
                <add name="Content-Security-Policy" value="default-src 'self'; connect-src 'self'; script-src 'self' https://cdnjs.cloudflare.com; style-src 'self' https://fonts.googleapis.com https://cdn.jsdelivr.net 'unsafe-inline'; img-src 'self' data:; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com; frame-src 'self'; object-src 'none'; base-uri 'self'; form-action 'self'; frame-ancestors 'none';"/>
                <add name="X-Frame-Options" value="SAMEORIGIN"/>
                <add name="X-Content-Type-Options" value="nosniff"/>
                <add name="Referrer-Policy" value="no-referrer"/>
                <add name="Permissions-Policy" value="geolocation=(), microphone=(), camera=()"/>
                <add name="X-Powered-By" value=" "/>
                <remove name="X-Powered-By" />
            </customHeaders>
        </httpProtocol>
 
        <rewrite>
            <rules>
                <!--  Allow static files to be served directly  -->
                <rule name="Static Files" stopProcessing="true">
                    <match url="^(.)\.(.)$"/>
                    <conditions logicalGrouping="MatchAll" trackAllCaptures="false"/>
                    <action type="None"/>
                </rule>
 
                <!--  Rewrite all other requests to index.html  -->
                <rule name="React Routes" stopProcessing="true">
                    <match url=".*"/>
                    <conditions logicalGrouping="MatchAll">
                        <add input="{REQUEST_URI}" pattern="^/(api|assets)/" negate="true"/>
                        <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true"/>
                        <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true"/>
                    </conditions>
                    <action type="Rewrite" url="/"/>
                </rule>
 
                <!-- Force HTTPS -->
                <rule name="Force HTTPS" stopProcessing="true">
                    <match url="(.*)"/>
                    <conditions>
                        <add input="{HTTPS}" pattern="off" ignoreCase="true"/>
                    </conditions>
                    <action type="Redirect" url="https://{HTTP_HOST}/{R:1}" redirectType="Permanent"/>
                </rule>
 
                <!-- Deny access to web.config -->
                <rule name="Deny Access to web.config" stopProcessing="true">
                    <match url="^web\.config$"/>
                    <action type="CustomResponse" statusCode="403" statusReason="Forbidden" statusDescription="Access denied"/>
                </rule>
            </rules>
        </rewrite>

        <security>
            <requestFiltering>
                <verbs>
                    <add verb="TRACE" allowed="false"/>
                </verbs>
            </requestFiltering>
        </security>
    </system.webServer>
</configuration>
